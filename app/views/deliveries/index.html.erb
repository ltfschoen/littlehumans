<br><br><br>

<div class="delivery-links">
  <%= link_to "Back", user_path(current_user), :class => "btn btn-default btn-lg active", :method => :get, :id => "make-new-delivery", :style => "width: 100%;" %> 
</div>

<div class="delivery-links">
  <%= link_to "Create", "/deliveries/new", :class => "btn btn-success btn-lg active", :method => :get, :id => "make-new-delivery", :style => "width: 100%;" %> 
</div>

<div class="delivery-links">
  <!-- fetch all deliveries -->
  <%= link_to "All", "/deliveries", :class => "btn btn-default btn-lg active", :method => :get, :id => "fetch-all-deliveries", :style => "width: 100%;" %> 
</div>

<div class="delivery-links">
  <%= link_to "My", "/deliveries?filter=my", :class => "btn btn-default btn-lg active", :method => :get, :id => "fetch-my-deliveries", :style => "width: 100%;" %> 
</div>

<% if @all == true %>
<h1>All Deliveries</h1>
<% elsif @all == false %>
<h1>My Deliveries</h1>
<% end %>

<table id="deliveries-list" class="table table-hover">

  <thead>
    <tr>
      <th class="delivery-centred">Baby Name</th>
      <th class="delivery-centred">DOB</th>
      <th class="delivery-centred">Birth Location</th>
      <th class="delivery-centred">Midwife & User ID</th>
      <% if @all == false %>
        <th></th>
      <% end %>
    </tr>
  </thead>

  <tbody id="tbody">
    <% @deliveries.each do |delivery| %>
    <tr onclick="showDelivery(<%= delivery.id %>)">
      <a id="fake_click_<%= delivery.id %>" href="/deliveries/<%= delivery.id %>"></a>
      <td onmouseover="" style="cursor: pointer;"><%= delivery.name_baby %></td>
      <td onmouseover="" style="cursor: pointer;"><%= delivery.time_born %></td>
      <td onmouseover="" style="cursor: pointer;"><%= delivery.name_location_born %></td>
      <td onmouseover="" style="cursor: pointer;"><%= delivery.user.name if delivery.user %> <%= delivery.user.id if delivery.user %></td>
      <% if @all == false %> <!-- only let midwife user who created baby make changes -->
      <td><%= link_to "Destroy", delivery, :method => :delete, :data => { :confirm => "Are you sure?" }, :class => "btn btn-default" %></td>
      <% end %>
    </tr>
    <% end %>
    User ID <%= current_user.id if current_user %>
  </tbody>

</table>

<script>
  /*
    in the deliveries view. when the user clicks one of the babies (anywhere on their row)
    an ajax query is performed to grab the babies details in json format from the database
    and once the ajax success handler indicates this action has been completed, we use 
    jQuery to switch the page that is displayed to be the 'show' page associated with 
    that baby (delivery) id. 
    this functionality improves the user experience as it replicates 'touch' functionality. 
    whereby the user is not constrained by only being able to click a small URL tag to 
    switch views.
  */
  function showDelivery(delivery) {
    console.log(delivery);
    var options = {
      url: "/deliveries/" + delivery, 
      type: "get",
      dataType: "json"
    }

    $.ajax(options).done(function(delivery) {
      console.log("ajax calendar success");
      console.log(delivery.id);
      dom = "#fake_click_" + delivery.id;
      console.log(dom);
      //https://developer.mozilla.org/en-US/docs/Web/API/Window.location
      var initialPage = window.location.pathname;
      console.log(initialPage);
      b = window.location.replace(initialPage + "/" + delivery.id);
      console.log(b);
    }).done(function(dom_data) { // success handler
      console.log("data is: " + dom_data);
    }).error(function(dom_data) { // failure handler
      console.log("error is: " + dom_data);
    });
  }

  $(document).ready(function() {
  });

</script>
